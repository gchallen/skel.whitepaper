#!/usr/bin/env python

import sys, re, os, textwrap
from optparse import OptionParser

parser = OptionParser()
(options, args) = parser.parse_args()

if len(args) < 2:
  sys.exit(1)

try:
  inlines = open(args[0], "r").read()
except:
  sys.exit(1)

try:
  outfile = open(args[1], "w")
except:
  sys.exit(1)

removecomments = re.compile(r"^(%.*)$", re.M)
inlines = removecomments.sub("", inlines)
removetex = re.compile(r"~?\\(section|cite)\{([^\}]+)}", re.M)
inlines = removetex.sub("", inlines)
keeptex = re.compile(r"~?\\(textit|textbf)\{([^\}]+)}", re.M)
inlines = keeptex.sub(r"\2", inlines)
output = '\n\n'.join([re.sub(r'\n', ' ', l) for l in re.split(r'\s{2,}', inlines)][1:])
print >>outfile, output
